"""
Note: TBC
"""

import networkx as nx
import numpy as np
import cartopy.crs as ccrs
from cartopy.io import shapereader as shpreader
import matplotlib.pyplot as plt
import sys
import inspect
from os import path  # wacky method - crutches...

# set up directory to read data from parent directory
basepath = path.dirname(__file__)
filepath = path.abspath(path.join(basepath, "..",
                                  "temp_data_1948_2021.npy"))

# use the compiled npy data generated by utils.py
with open(filepath, 'rb') as f:
    T = np.load(f)
    lat = np.load(f)
    lon = np.load(f)

"""
This is a very whacky way to import from utils.py 
in the directory above without us using a package:
https://stackoverflow.com/questions/714063/importing-modules-
from-parent-folder
"""
currentdir = path.dirname(path.abspath(inspect.getfile(inspect.currentframe())))
parentdir = path.dirname(currentdir)
sys.path.insert(0, parentdir)
from utils import *

# testing
edges = np.array([['A', 'B'],
                 ['B', 'C'],
                 ['C', 'D'],
                 ['C', 'A']])
pos = {
       'A': [150, 5], 
       'B': [110, 15], 
       'C': [140, -25], 
       'D': [160, -30]
}

G = nx.from_edgelist(edges)
sg = next(G.subgraph(c) for c in nx.connected_components(G))

# get year data
year = 1972
print("Computing data for year: ", year)
C, T_in, T_out = year_series(T, lat, lon, year)

# draw background map
crs = ccrs.PlateCarree(central_longitude = 178.75)
fig, ax = plt.subplots(
    1, 1, figsize=(10.24, 7.68),
    subplot_kw=dict(projection=crs))
ax.coastlines()
ax.set_global()

# draw network with networkx over catopy
nx.draw_networkx(sg, ax=ax,
                 font_size=16,
                 alpha=1,
                 width=2,
                 pos=pos,
                 cmap=plt.cm.autumn)
                 
plt.show()